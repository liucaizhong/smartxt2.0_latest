"use strict";function onExpandContent(e,t){t.preventDefault();var a=$(e);a.parent().find(".short").hide(),a.parent().find(".long").show(),a.hide().parent().parent().parent().find(".collapse-btn").show()}function onCollapseContent(e){var t=$(e);t.parent().parent().find(".short").show(),t.parent().parent().find(".long").hide(),t.parent().parent().find(".expand-btn").show(),t.hide()}function clearSearch(e){$("#newsInput").val(""),$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),$(e).hide(),keyword="",_renderMoreNews()}function onCategory(e){$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),e.stopPropagation();var t=e.target;if("LABEL"===t.tagName){var a=$(t);if(+a.attr("data-id"))if(a.hasClass("active")){a.removeClass("active");var n=a.attr("data-id"),s=activeCategory.indexOf(n);activeCategory.splice(s,1),activeCategory.length||(activeCategory=["0"],a.parent().find("[data-id=0]").addClass("active"))}else{var i=a.parent().find("[class*=active]").length,r=a.siblings().length-1;if(i==r)a.parent().find("[class*=active]").removeClass("active"),a.parent().find("[data-id=0]").addClass("active"),activeCategory=["0"];else{a.addClass("active"),a.parent().find("[data-id=0]").removeClass("active");var s=activeCategory.indexOf("0");s!=-1&&activeCategory.splice(s,1),activeCategory.push(a.attr("data-id"))}}else a.parent().find("[class*=active]").removeClass("active"),a.hasClass("active")||(a.addClass("active"),activeCategory.push(a.attr("data-id")),activeCategory=["0"]);_renderMoreNews()}console.log("activeCategory",activeCategory)}function onIndustry(e){$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),e.stopPropagation();var t=e.target;if("LABEL"===t.tagName){var a=$(t);if(+a.attr("data-id"))if(a.hasClass("active")){a.removeClass("active");var n=a.attr("data-id"),s=activeIndustry.indexOf(n);activeIndustry.splice(s,1),activeIndustry.length||(activeIndustry=["0"],a.parent().find("[data-id=0]").addClass("active"))}else{var i=a.parent().find("[class*=active]").length,r=a.siblings().length-1;if(i==r)a.parent().find("[class*=active]").removeClass("active"),a.parent().find("[data-id=0]").addClass("active"),activeIndustry=["0"];else{a.addClass("active"),a.parent().find("[data-id=0]").removeClass("active");var s=activeIndustry.indexOf("0");s!=-1&&activeIndustry.splice(s,1),activeIndustry.push(a.attr("data-id"))}}else a.parent().find("[class*=active]").removeClass("active"),a.hasClass("active")||(a.addClass("active"),activeIndustry.push(a.attr("data-id")),activeIndustry=["0"]);_renderMoreNews()}console.log("activeIndustry",activeIndustry)}function _getStrLength(e){for(var t=0,a=e.length,n=-1,s=0;s<a;s++)n=e.charCodeAt(s),t+=n>=0&&n<=128?1:2;return t}function _cutStr(e,t,a){var n=_getStrLength(e),s=0,i="";if(t>=n)return $(a).find("span.short").html(e),a;for(var r=0;r<n;r++){var o=e.charAt(r);if(s++,escape(o).length>4&&s++,i=i.concat(o),s>=t)return $(a).find("span.short").html(i+"......"),$(a).find("span.long").html(e),$(a).find(".expand-btn").removeClass("none"),a}}function _renderMoreNews(e){$("div.focus-loading").show(),e||(lastId=-1,$(".news-content>ol").empty());var t=URL_NEWS+"userId="+loginfo.username+"&lastId="+lastId;t+=keyword?"&keyword="+keyword:"&keyword=",t+=abstract?"&absOnly=1":"&absOnly=0",t+=selfChoice?"&selfStocksOnly=1":"&selfStocksOnly=0","0"==activeCategory[0]?t+="&types=":(t+="&types=",activeCategory.forEach(function(e){t+="'"+categoryRange[+e]+"',"}),t=t.substr(0,t.length-1)),"0"==activeIndustry[0]?t+="&indus=":(t+="&indus=",activeIndustry.forEach(function(e){t+="'"+industryCategory[+e]+"',"}),t=t.substr(0,t.length-1)),$.ajax({url:t,type:"GET",async:!0,dataType:"json",success:function(t){var a=JSON.parse(t);a=JSON.parse(a),a&&a.length?(a.forEach(function(e){_renderNewsContent(e)}),keyword&&$(".news-content").highlight(keyword),$(".more-button span:nth-child(2)").hasClass("active")&&$(".more-button span:nth-child(2)").removeClass("active"),$(".more-button span:nth-child(1)").addClass("active")):($(".more-button").find("[class*=active]").removeClass("active"),e?$("footer").show():$(".news-content>ol").html('<li style="font-size:2rem;">未找到相关公告</li>')),$("div.focus-loading").hide()},error:function(e){console.log(e)}})}function _renderNewsContent(e){var t=$(".news-content>ol"),a=lastId!=-1,n=!1,s=new Date(e.showtime),i=s.getMonth()+1,r=s.getDate();if(a){var o=$("#"+lastId),d=o.parent(),c=+d.parent().find("header>.date em").text(),l=+d.parent().find("header>.date b").text();if(c!=i||l!=r)n=!0;else{var v=$('<li class="bottom-line">\n                            <div>\n                                <h2 class="title"></h2>\n                                <div>\n                                    <p>\n                                        <span class="short"></span>\n                                        <span class="long none"></span>\n                                        <a class="expand-btn none" href="" onclick="onExpandContent(this,event)">显示全部</a>\n                                        <a class="none" target="_blank">查看原文</a>\n                                    </p>\n                                </div>\n                                <div class="news-footer">\n                                    <span class="tag-date"></span>\n                                    <span>标签：</span>\n                                    <span class="tag-indus"></span>\n                                    <span class="tag-type"></span>\n                                    <button class="collapse-btn none" onclick="onCollapseContent(this)"><i class="fa fa-hand-o-up" aria-hidden="true" style="font-size: 16px;"></i>&nbsp;收起</button>\n                                </div>\n                            </div>\n                        </li>');$(v).attr("id",e.increaseId),$(v).find("h2").text(e.name+"("+e.code+") "+e.title),e.link&&$(v).find("a[target=_blank]").attr("href",e.link).removeClass("none"),e.abs&&(v=_cutStr(e.abs,MAX_ABS,v)),$(v).find("span.tag-date").text(e.showtime.split(".")[0]),$(v).find("span.tag-indus").text(e.indus),$(v).find("span.tag-type").text(e.type),d.append(v)}}else n=!0;if(n){var v=$('<li class="sameday-news">\n                    <header>\n                        <div class="date">\n                            <span><em></em>月</span>\n                            <b></b>\n                        </div>\n                    </header>\n                    <ul>\n                        <li class="bottom-line">\n                            <div>\n                                <h2 class="title"></h2>\n                                <div>\n                                    <p>\n                                        <span class="short"></span>\n                                        <span class="long none"></span>\n                                        <a class="expand-btn none" href="" onclick="onExpandContent(this,event)">显示全部</a>\n                                        <a class="none" target="_blank">查看原文</a>\n                                    </p>\n                                </div>\n                                <div class="news-footer">\n                                    <span class="tag-date"></span>\n                                    <span>标签：</span>\n                                    <span class="tag-indus"></span>\n                                    <span class="tag-type"></span>\n                                    <button class="collapse-btn none" onclick="onCollapseContent(this)"><i class="fa fa-hand-o-up" aria-hidden="true" style="font-size: 16px;"></i>&nbsp;收起</button>\n                                </div>\n                            </div>\n                        </li>                   \n                    </ul>\n                </li>');$(v).find(".date em").text(i),$(v).find(".date b").text(r),$(v).find(".bottom-line").attr("id",e.increaseId),$(v).find("h2").text(e.name+"("+e.code+") "+e.title),e.link&&$(v).find("a[target=_blank]").attr("href",e.link).removeClass("none"),e.abs&&(v=_cutStr(e.abs,MAX_ABS,v)),$(v).find("span.tag-date").text(e.showtime.split(".")[0]),$(v).find("span.tag-indus").text(e.indus),$(v).find("span.tag-type").text(e.type),t.append(v)}lastId=e.increaseId}var INTERVAL=18e5,abstract=!0,selfChoice=!1,activeCategory=["0"],categoryRange=["*","业绩预报","业绩快报","项目收购","人事变动","利润分配","增持减持","资金用途","资产重组","增发预案","重大合同","年度报告","举牌"],activeIndustry=["0"],industryCategory=["*","非银金融","传媒","交通运输","建筑材料","纺织服装","房地产","医药生物","有色金属","轻工制造","采掘","农林牧渔","休闲服务","家用电器","钢铁","汽车","国防军工","综合","机械设备","公用事业","银行","化工","电气设备","通信","商业贸易","计算机","电子","食品饮料","建筑装饰"],keyword="",URL_NEWS="/cross?id=19&",loginfo,lastId=-1,MAX_ABS=500;$(document).ready(function(){if(window.user){loginfo=window.user.replace(/&quot;/g,'"'),loginfo=JSON.parse(loginfo),delete window.user,$("footer").hide(),_renderMoreNews();var e=setInterval(_renderMoreNews,INTERVAL)}$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&($(".more-button span:nth-child(1)").removeClass("active"),$(".more-button span:nth-child(2)").addClass("active"),_renderMoreNews(!0))}),$("#newsInput").keydown(function(e){13==e.keyCode&&(e.preventDefault(),$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),_renderMoreNews())}),$("#newsInput").on("input propertychange",function(e){var t=$(this).val();t?($("#search-clear").show(),keyword=t):($("#search-clear").hide(),keyword="")}),$(".auto-refresh > input[name=refresh]").change(function(t){this.checked?e=setInterval(_renderMoreNews,INTERVAL):clearInterval(e)}),$(".auto-refresh > input[name=abstract]").change(function(e){abstract=!abstract,$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),_renderMoreNews()}),$(".auto-refresh > input[name=self]").change(function(e){selfChoice=!selfChoice,$("footer").hide(),$(".more-button").find("[class*=active]").removeClass("active"),_renderMoreNews()})});
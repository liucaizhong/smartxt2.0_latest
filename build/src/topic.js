"use strict";function onStar(t){var e=$(t);if(e.hasClass("collect"))var o=URL_UNCOLLECT,a="取消收藏",n={userId:loginfo.username,links:cond.stock+"@"+cond.topic};else var o=URL_COLLECT,a="已收藏",n={userId:loginfo.username,code:cond.stock,topic:cond.topic};$.ajax({url:o,method:"POST",data:n,dataType:"json",success:function(t){var o=JSON.parse(t);o=JSON.parse(o),o.flag||o[0].status?(e.toggleClass("collect"),_showFadeMsg(a)):_showFadeMsg(o.msg)},error:function(t){console.log(t)}})}function _renderDatalist(t){var e=$("#topicList");t.forEach(function(t){var o=document.createElement("OPTION");$(o).val(t),e.append(o)})}function _renderChart(t){$("div.focus-loading").show(),chartAttention=echarts.init(document.getElementById("chart-attention")),chartPrice=echarts.init(document.getElementById("chart-price")),echarts.connect([chartAttention,chartPrice]),$.ajax({url:t,success:function(t){var e=[],o=[],a=[],n=cond.stock+"-"+cond.topic,r=JSON.parse(t);r=JSON.parse(r);var c=r.topicHeat;if(!c||!c.length)return _showErr("找不到相关信息"),$("div.focus-loading").hide(),!1;var i=r.flag,s=$(".charts .topic-collect .btn-star");0==i||-1==i?s.hasClass("collect")&&s.removeClass("collect"):1==i&&(s.hasClass("collect")||s.addClass("collect")),$("#stockInput").val(""),$("#eventInput").val(""),$(".charts .topic-collect").show(),c.forEach(function(t){a.push(t.date),e.push(t.heat),o.push(t.index)}),chartAttention.setOption({baseOption:{title:{text:""},tooltip:{trigger:"axis"},dataZoom:[{handleColor:"rgb(75,188,208)",fillerColor:"rgb(75,188,208)",borderWidth:0,show:!0,realtime:!0,start:75.5,end:100,height:15}],legend:{data:[{name:n,icon:"line"}]},toolbox:{feature:{saveAsImage:{}}},xAxis:[{type:"category",data:a,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisTick:!1,axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},boundaryGap:!1}],yAxis:[{name:"关注度(H)",type:"value",scale:!0,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},axisTick:!1,nameTextStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"},splitNumber:10,splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#dcdcdc"}}}],series:[{name:n,type:"line",data:e,itemStyle:{normal:{color:"rgb(50,70,95)"}}}]}}),chartPrice.setOption({baseOption:{title:{text:""},tooltip:{trigger:"axis"},dataZoom:[{handleColor:"rgb(75,188,208)",fillerColor:"rgb(75,188,208)",borderWidth:0,show:!0,realtime:!0,start:75.5,end:100,height:15}],legend:{data:[{name:n,icon:"line"}]},toolbox:{feature:{saveAsImage:{}}},xAxis:[{type:"category",data:a,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisTick:!1,axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},boundaryGap:!1}],yAxis:[{name:"价格指数(I)",type:"value",scale:!0,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},axisTick:!1,nameTextStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"},splitNumber:10,splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#dcdcdc"}}}],series:[{name:n,type:"line",data:o,itemStyle:{normal:{color:"rgb(230,85,30)"}}}]}}),$("div.focus-loading").hide()},error:function(t){console.log(t)}})}function customOpStock(t){if(t){var e=$(t),o=e.find('span[class*="item-2"]').text();$("#stockInput").val(o)}}function _showErr(t){$("div#error-msg>strong").text(t),$("div#error-msg").show(500)}function _hideErr(){$("div#error-msg").hide(500)}function delAlert(t){var e=$(t);e.parent().hide(500)}function _showFadeMsg(t){var e=$(".topic-collect>span").offset().left-50,o=$(".topic-collect>span").offset().top+50;$("#fade-msg").text(t),$("#fade-alert").css({left:e,top:o}).fadeIn(function(){setTimeout(function(){$("#fade-alert").fadeOut()},1e3)})}function onPool(t){$("#topic-tags").children().show();var e=$(document).height();$("#pool").height(e).show()}function destroyPool(t){$("#pool").hide(),clearSearch()}function clearSearch(t){$("#topicPoolInput").val(""),$("#topic-tags").children().show(),$("#search-clear").hide()}function _renderTopicTags(t){var e=$("#topic-tags");t.forEach(function(t){var o=$('<label class="label-category" ></label>');$(o).attr("data-value",t.code+"|"+t.name+"|"+t.event),$(o).text(t.code+"-"+t.name+"-"+t.event),e.append(o)})}function checkTag(t){if(t.stopPropagation(),"LABEL"===t.target.tagName){destroyPool();var e=$(".charts .topic-collect .btn-star");e.hasClass("collect")&&e.removeClass("collect");var o=$(t.target).attr("data-value").split("|");cond.topic=o[2],cond.stock=o[1];var a=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+cond.stock+"&topic="+cond.topic;_renderChart(a)}}var URL_TOPICHEAT="/cross?id=2&",URL_COLLECT="/crosspost?id=15",URL_UNCOLLECT="/crosspost?id=16",URL_ALLTOPICS="/cross?id=24&",URL_TOPICLIST="/cross?id=25",cond={topic:"",stock:""},loginfo,jump=!1,chartAttention=echarts.init(document.getElementById("chart-attention")),chartPrice=echarts.init(document.getElementById("chart-price"));echarts.connect([chartAttention,chartPrice]),$(document).ready(function(){if(window.user){loginfo=window.user.replace(/&quot;/g,'"'),loginfo=JSON.parse(loginfo),delete window.user;var t=URL_ALLTOPICS+"userId="+loginfo.username+"&keyword=";$.ajax({url:t,type:"GET",async:!0,dataType:"json",success:function(t){var e=JSON.parse(t);if(e=JSON.parse(e),e&&e.length){Math.floor(Math.random()*(e.length>5?5:e.length));_renderTopicTags(e)}},error:function(t){console.log(t)}})}if(window.topic&&window.stock){var e=unescape(decodeURIComponent(window.topic)),o=unescape(decodeURIComponent(window.stock));delete window.topic,delete window.stock,cond.topic=e,cond.stock=o,jump=!0;var a=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+o+"&topic="+e;_renderChart(a)}else{cond.topic="举牌",cond.stock="金科股份";var a=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+cond.stock+"&topic="+cond.topic;jump||_renderChart(a)}$.ajax({url:URL_TOPICLIST,type:"GET",async:!0,dataType:"json",success:function(t){var e=JSON.parse(t);e=JSON.parse(e),e&&e.length&&_renderDatalist(e)},error:function(t){console.log(t)}}),$(window).on("resize",function(){chartAttention.resize(),chartPrice.resize()}),$("#stockInput").on("input propertychange",function(t){$(this).val()&&$(this).hasClass("error")&&$(this).removeClass("error")}),$("#eventInput").on("input propertychange",function(t){$(this).val()&&$(this).hasClass("error")&&$(this).removeClass("error")}),$("#form-topic").submit(function(t){t.preventDefault(),_hideErr();var e=$("#stockInput").val(),o=$("#eventInput").val();if(!e)return $("#stockInput").addClass("error"),!1;if(!o)return $("#eventInput").addClass("error"),!1;cond.topic=o,cond.stock=e;var a=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+e+"&topic="+o;_renderChart(a)}),$("#topicPoolInput").on("input propertychange",function(t){var e=$(this).val();e?($("#search-clear").show(),$("#topic-tags").find(":not(label[data-value*='"+e+"'])").hide(),$("#topic-tags").find("label[data-value*='"+e+"']").show()):$("#topic-tags").children().show()})});
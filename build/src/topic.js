"use strict";function onStar(e){var t=$(e).find("i");if(t.hasClass("icon-collected"))var o=URL_UNCOLLECT,n="取消收藏",a={userId:loginfo.username,links:cond.stock+"@"+cond.topic};else var o=URL_COLLECT,n="已收藏",a={userId:loginfo.username,code:cond.stock,topic:cond.topic};$.ajax({url:o,method:"POST",data:a,dataType:"json",success:function(e){var o=JSON.parse(e);o.flag||o[0].status?(t.toggleClass("icon-collected"),_showFadeMsg(n)):_showFadeMsg(o.msg)},error:function(e){console.log(e)}})}function _renderDatalist(e){var t=$("#topicList");e.forEach(function(e){var o=document.createElement("OPTION");$(o).val(e),t.append(o)})}function _renderChart(e){$("div.focus-loading").show(),chartAttention=echarts.init(document.getElementById("chart-attention")),chartPrice=echarts.init(document.getElementById("chart-price")),echarts.connect([chartAttention,chartPrice]),$.ajax({url:encodeURI(e),cache:!1,success:function(e){var t=[],o=[],n=[],a=cond.stock+"-"+cond.topic,i=JSON.parse(e),c=i.topicHeat;if(!c||!c.length)return _showErr("找不到相关信息"),$("div.focus-loading").hide(),!1;var r=i.flag,s=$("i[class*=icon-collect]");0==r||-1==r?s.hasClass("icon-collected")&&s.removeClass("icon-collected"):1==r&&(s.hasClass("icon-collected")||s.addClass("icon-collected")),$("#stockInput").val(""),$("#eventInput").val(""),c.forEach(function(e){n.push(e.date),t.push(e.heat),o.push(e.index)}),chartAttention.setOption({baseOption:{title:{text:""},tooltip:{trigger:"axis"},dataZoom:[{handleColor:"rgb(75,188,208)",fillerColor:"rgb(75,188,208)",borderWidth:0,show:!0,realtime:!0,start:75.5,end:100,height:15}],legend:{data:[{name:a,icon:"line"}]},toolbox:{feature:{saveAsImage:{}}},xAxis:[{type:"category",data:n,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisTick:!1,axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},boundaryGap:!1}],yAxis:[{name:"关注度(H)",type:"value",scale:!0,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},axisTick:!1,nameTextStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"},splitNumber:10,splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#dcdcdc"}}}],series:[{name:a,type:"line",data:t,itemStyle:{normal:{color:"rgb(50,70,95)"}}}]}}),chartPrice.setOption({baseOption:{title:{text:""},tooltip:{trigger:"axis"},dataZoom:[{handleColor:"rgb(75,188,208)",fillerColor:"rgb(75,188,208)",borderWidth:0,show:!0,realtime:!0,start:75.5,end:100,height:15}],legend:{data:[{name:a,icon:"line"}]},toolbox:{feature:{saveAsImage:{}}},xAxis:[{type:"category",data:n,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisTick:!1,axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},boundaryGap:!1}],yAxis:[{name:"价格指数(I)",type:"value",scale:!0,axisLine:{show:!0,lineStyle:{type:"solid",width:1,color:"rgb(75,188,208)"}},axisLabel:{textStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"}},axisTick:!1,nameTextStyle:{fontFamily:"微软雅黑",fontSize:12,color:"black"},splitNumber:10,splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#dcdcdc"}}}],series:[{name:a,type:"line",data:o,itemStyle:{normal:{color:"rgb(230,85,30)"}}}]}}),$("div.focus-loading").hide()},error:function(e){console.log(e)}})}function customOpStock(e){if(e){var t=$(e),o=t.find('span[class*="item-2"]').text();$("#stockInput").val(o)}}function _showErr(e){$("div#error-msg>strong").text(e),$("div#error-msg").show(500)}function _hideErr(){$("div#error-msg").hide(500)}function delAlert(e){var t=$(e);t.parent().hide(500)}function _showFadeMsg(e){var t=$(".suspending-toolbar").offset().left-50,o=$(".suspending-toolbar").offset().top+100;$("#fade-msg").text(e),$("#fade-alert").css({left:t,top:o}).fadeIn(function(){setTimeout(function(){$("#fade-alert").fadeOut()},1e3)})}function onPool(e){$("#topic-tags").children().show();var t=$(document).height();$("#pool").height(t).show()}function destroyPool(e){$("#pool").hide(),clearSearch()}function clearSearch(e){$("#topicPoolInput").val(""),$("#topic-tags").children().show(),$("#search-clear").hide()}function _renderTopicTags(e){var t=$("#topic-tags");e.forEach(function(e){var o=$('<label class="label-category" ></label>');$(o).attr("data-value",e.code+"|"+e.name+"|"+e.event),$(o).text(e.code+"-"+e.name+"-"+e.event),t.append(o)})}function checkTag(e){if(e.stopPropagation(),"LABEL"===e.target.tagName){destroyPool();var t=$(".charts .topic-collect .btn-star");t.hasClass("collect")&&t.removeClass("collect");var o=$(e.target).attr("data-value").split("|");cond.topic=o[2],cond.stock=o[1];var n=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+cond.stock+"&topic="+cond.topic;_renderChart(n)}}var URL_TOPICHEAT="/cross?id=2&",URL_COLLECT="/crosspost?id=15",URL_UNCOLLECT="/crosspost?id=16",URL_ALLTOPICS="/cross?id=24&",URL_TOPICLIST="/cross?id=25",cond={topic:"",stock:""},loginfo,jump=!1,chartAttention=echarts.init(document.getElementById("chart-attention")),chartPrice=echarts.init(document.getElementById("chart-price"));echarts.connect([chartAttention,chartPrice]),$(document).ready(function(){if(window.user){loginfo=window.user.replace(/&quot;/g,'"'),loginfo=JSON.parse(loginfo),delete window.user;var e=URL_ALLTOPICS+"userId="+loginfo.username+"&keyword=";$.ajax({url:encodeURI(e),type:"GET",async:!0,cache:!1,success:function(e){var t=JSON.parse(e);if(t&&t.length){Math.floor(Math.random()*(t.length>5?5:t.length));_renderTopicTags(t)}},error:function(e){console.log(e)}})}if(window.topic&&window.stock){var t=unescape(decodeURIComponent(window.topic)),o=unescape(decodeURIComponent(window.stock));delete window.topic,delete window.stock,cond.topic=t,cond.stock=o,jump=!0;var n=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+o+"&topic="+t;_renderChart(n)}else{cond.topic="举牌",cond.stock="金科股份";var n=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+cond.stock+"&topic="+cond.topic;jump||_renderChart(n)}$.ajax({url:encodeURI(URL_TOPICLIST),type:"GET",async:!0,cache:!1,success:function(e){var t=JSON.parse(e);t&&t.length&&_renderDatalist(t)},error:function(e){console.log(e)}}),$(window).on("resize",function(){chartAttention.resize(),chartPrice.resize();var e=$(window).width();e<1520&&e>795?$(".suspending-toolbar").css({right:"8%"}):e<795?$(".suspending-toolbar").css({right:"5%"}):$(".suspending-toolbar").css({right:"15%"})}),$(window).resize(),$("#stockInput").on("input propertychange",function(e){$(this).val()&&$(this).hasClass("error")&&$(this).removeClass("error")}),$("#eventInput").on("input propertychange",function(e){$(this).val()&&$(this).hasClass("error")&&$(this).removeClass("error")}),$("#form-topic").submit(function(e){e.preventDefault(),_hideErr();var t=$("#stockInput").val(),o=$("#eventInput").val();if(!t)return $("#stockInput").addClass("error"),!1;if(!o)return $("#eventInput").addClass("error"),!1;cond.topic=o,cond.stock=t;var n=URL_TOPICHEAT+"userId="+loginfo.username+"&stock="+t+"&topic="+o;_renderChart(n)}),$("#topicPoolInput").on("input propertychange",function(e){var t=$(this).val();t?($("#search-clear").show(),$("#topic-tags").find(":not(label[data-value*='"+t+"'])").hide(),$("#topic-tags").find("label[data-value*='"+t+"']").show()):$("#topic-tags").children().show()})});
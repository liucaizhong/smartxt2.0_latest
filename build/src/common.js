"use strict";function clearSearch(t){$("#stockInput").val(""),$(t).hide(),_hideStockList()}function _showStockList(){var t=$("#stockList")[0];$(t).show(),listTop=t.offsetTop,listLeft=t.offsetLeft,listWidth=t.offsetWidth,listHeight=t.offsetHeight}function _hideStockList(){$("#stockList").hide(),listTop=0,listLeft=0,listWidth=0,listHeight=0}function _addHandlerToLI(t){$(t).click(function(t){_hideStockList(),customOpStock(this)}).hover(function(t){$(this).siblings('li[class*="stock-li-hover"]').removeClass("stock-li-hover"),$(this).hasClass("stock-li-hover")||$(this).addClass("stock-li-hover"),stockHover=$(this).find("div").attr("rel")},function(t){var s=t.pageX,i=t.pageY;listTop&&listLeft&&listWidth&&listHeight&&(s<=listLeft||s>=listLeft+listWidth||i<=listTop||i>=listTop+listHeight||$(this).hasClass("stock-li-hover")&&$(this).removeClass("stock-li-hover"))})}function expandNavbar(t,s){t.preventDefault();var i=$("#main-nav");s?i.addClass("my-index-navbar"):i.addClass("my-navbar")}function _renderIndexStocklist(t){var s=$("#allConcepts");t.forEach(function(t){var i=document.createElement("OPTION");$(i).val(t.name).text("股票代码："+t.code),s.append(i)})}var URL_STOCKLIST="/cross?id=11",stocks=[],LISTMAX=10,listTop=0,listLeft=0,listWidth=0,listHeight=0,stockHover=0;$(document).ready(function(){$(window).resize(function(t){if($(this).width()>991){var s=$("#main-nav");s.hasClass("my-navbar")&&s.removeClass("my-navbar")}}),$("input, textarea").placeholder(),$(".weixin").hover(function(t){var s=t.pageY-200,i=t.pageX-80,e=document.createElement("IMG");e.id="weixin-qr",e.src="../img/icon/weixin.jpg",$(e).css({display:"block",position:"absolute",top:s,left:i,"z-index":999}),$("body").append(e)},function(t){$("img").remove("#weixin-qr")}),$(".apple").hover(function(t){var s=t.pageY-200,i=t.pageX-80,e=document.createElement("IMG");e.id="apple-qr",e.src="../img/icon/apple.png",$(e).css({display:"block",position:"absolute",top:s,left:i,"z-index":999}),$("body").append(e)},function(t){$("img").remove("#apple-qr")}),$('[data-hover="dropdown"]').hover(function(t){var s=$(this);s.find("div.dropdown-menu").css("display","block")},function(t){var s=$(this),i=s.find("div")[0],e=$(i).children().length+1,n=s.offset().top,o=s.offset().left,a=o+100,r=n+60*e,l=t.pageX,c=t.pageY;(l<=o||l>=a||c<=n||c>=r)&&s.find("div.dropdown-menu").css("display","none")}),$.ajax({url:encodeURI(URL_STOCKLIST),type:"GET",async:!0,cache:!1,success:function(t){var s=JSON.parse(t);s.forEach(function(t){stocks.push(t.code+t.name)}),_renderIndexStocklist(s)},error:function(t){console.log(t)}}),$("#stockInput").on("input propertychange",function(t){var s=$(this).val();if($(this).hasClass("error")&&$(this).removeClass("error"),!s)return void _hideStockList();var i=s.length,e=new RegExp(s,"ig"),n=0,o=$('ul[class*="stock-ul"')[0],a=$(o);a.children()&&a.empty(),stocks.every(function(t){var s=t.search(e);if(s!=-1){if(s<6&&s+i<=6){var o=$('<span class="item-1"></span>'),r=t.substring(0,s)+"<strong>"+t.substr(s,i)+"</strong>";r+=t.substring(i+s,6),$(o).html(r);var l=$('<span class="item-2"></span>').text(t.slice(6)),c=$("<div></div>").attr("rel",n);$(c).append(o).append(l);var d=$("<li></li>").append(c);n||$(d).addClass("stock-li-hover"),_addHandlerToLI(d),a.append(d),++n}if(s>=6){var o=$('<span class="item-1"></span>').text(t.substring(0,6)),l=$('<span class="item-2"></span>'),r=t.substring(6,s)+"<strong>"+t.substr(s,i)+"</strong>";r+=t.slice(i+s),$(l).html(r);var c=$("<div></div>").attr("rel",n);$(c).append(o).append(l);var d=$("<li></li>").append(c);n||$(d).addClass("stock-li-hover"),_addHandlerToLI(d),a.append(d),++n}if(n>=LISTMAX)return _showStockList(),!1}return!0}),n>0?_showStockList():(a.append($('<li class="stock-not-found">未找到符合条件的结果</li>')),$(this).hasClass("error")||$(this).addClass("error"),_showStockList())}),$("#stockInput").focus(function(t){$(this).val()&&$(this).trigger("input")}),$(window).click(function(t){var s=t.pageX,i=t.pageY;0==$("#stockInput:focus").length&&listTop&&listLeft&&listWidth&&listHeight&&(s<=listLeft||s>=listLeft+listWidth||i<=listTop||i>=listTop+listHeight)&&_hideStockList()}),$("#stockInput").keydown(function(t){var s=t.keyCode,i=$('li[class*="stock-li-hover"]')[0],e=+$(i).find("div").attr("rel"),n=$("#stockList li").children().length;switch(s){case 13:t.preventDefault(),$(this).blur(),_hideStockList(),customOpStock(i);break;case 38:t.preventDefault(),0!=e&&e-1>=0&&($("#stockList>ul li:nth-child("+(e+1)+")").removeClass("stock-li-hover"),$("#stockList>ul li:nth-child("+e+")").addClass("stock-li-hover"));break;case 40:t.preventDefault(),9!=e&&e+1<n&&($("#stockList>ul li:nth-child("+(e+1)+")").removeClass("stock-li-hover"),$("#stockList>ul li:nth-child("+(e+2)+")").addClass("stock-li-hover"))}})}),$.fn.extend({highlight:function(t,s){if("undefined"!=typeof t){var s=$.extend({insensitive:!0,hlClass:"highlight",clearLast:!0},s);return s.clearLast&&$(this).find("strong."+s.hlClass).each(function(){$(this).after($(this).text()),$(this).remove()}),this.each(function(i,e){$(e).highregx(t,s)})}},highregx:function(t,s){t=this.unicode(t);var i=new RegExp("(<[^>]*>)|("+t+")",s.insensitive?"ig":"g");this.html(this.html().replace(i,function(t,i,e){return"<"==t.charAt(0)?t:'<strong class="'+s.hlClass+'">'+e+"</strong>"}))},unicode:function(t){var s="";t=t.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1");for(var i=0;i<t.length;i++)s+=t.charCodeAt(i)>255?"\\u"+t.charCodeAt(i).toString(16):t.charAt(i);return s}}),$.extend({StandardPost:function(t,s){var i,e=document.body,n=$("<form method='post'></form>")[0];$(n).attr({action:t}).css("display","none"),$.each(s,function(t,s){i=$("<input type='hidden'>"),i.attr({name:t}),i.val(s),$(n).append(i)}),e.appendChild(n),n.submit(),e.removeChild(n)}});